<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <script src="https://cdn.nira.app/sdk/latest/nira-sdk.js"></script>
</head>

<body style="margin:0; overflow:hidden;">

  <iframe
    id="niraviewer"
    style="width:100vw; height:100vh; border:none;"
    src="https://app.nira.app/model/YOUR_MODEL_ID">
  </iframe>

  <script>
    document.addEventListener("DOMContentLoaded", function () {

      const iframe = document.getElementById("niraviewer");

      iframe.addEventListener("load", function () {

        const viewer = new NiraAPI.Viewer(iframe, {
          enableCallouts: true,
          enableObjectPicking: false
        });

        // ==============================
        // 1️⃣ PRØV REN EVENT-LYTTER
        // ==============================

        viewer.on("callout_activated", function (event) {

          console.log("CALLOUT ACTIVATED:", event);

          const key = event.uuid || event.id;

          if (key && window.FileMaker) {
            FileMaker.PerformScript("Test_From_Nira", key);
          }

        });


        // ==============================
        // 2️⃣ FALLBACK (hvis event ikke trigges)
        // ==============================

        let lastSelected = null;

        setInterval(async function () {

          if (!viewer.getCallouts) return;

          const callouts = await viewer.getCallouts();
          const selected = callouts.find(c => c.selected === true);

          if (selected && selected.uuid !== lastSelected) {

            lastSelected = selected.uuid;

            console.log("CALLOUT SELECTED (polling):", selected);

            if (window.FileMaker) {
              FileMaker.PerformScript("Test_From_Nira", selected.uuid);
            }
          }

        }, 500);

      });

    });
  </script>

</body>
</html>
