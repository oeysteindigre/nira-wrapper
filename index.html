<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">

<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />

<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  overflow: hidden;
}
#niraviewer {
  width: 100%;
  height: 100%;
  border: 0;
}
</style>

<script src="https://sdk.nira.app/js/viewer.js"></script>
</head>

<body>

<iframe
  id="niraviewer"
  src="https://nidaros.nira.app/g/y-93qFDYS2W-8ACrlqVj8A">
</iframe>

<script>

let viewer = new NiraAPI.Viewer(
  document.getElementById("niraviewer"),
  {
    showNavigationTools: true,
    showMeasureTool: true,
    showCalloutsList: true,
    showRenderModes: true,
    suppressCalloutDialog: true
  }
);

/* --------------------------------------------------
   ðŸ”µ FileMaker â†’ Viewer
-------------------------------------------------- */

function activateFromFileMaker(uuid) {
  alert("UUID from FileMaker: " + uuid);
}


/* --------------------------------------------------
   ðŸ”µ Viewer â†’ FileMaker
-------------------------------------------------- */

viewer.on("callout_created", function (info) {
  sendToFileMaker(info.uuid);
});

viewer.on("callout_activated", function (info) {
  sendToFileMaker(info.uuid);
});

/* --------------------------------------------------
   ðŸ”µ Bridge
-------------------------------------------------- */

function sendToFileMaker(uuid) {

  if (!uuid) return;

  try {

    if (window.FileMaker && FileMaker.PerformScript) {
      FileMaker.PerformScript("Test_From_nira", uuid);
      return;
    }

    if (window.FileMaker && FileMaker.PerformScriptWithOption) {
      FileMaker.PerformScriptWithOption("Test_From_nira", uuid, 0);
      return;
    }

    if (window.parent && window.parent.FileMaker) {
      window.parent.FileMaker.PerformScriptWithOption("Test_From_nira", uuid, 0);
      return;
    }

  } catch (e) {
    console.log("Bridge error:", e);
  }
}

</script>

</body>
</html>

